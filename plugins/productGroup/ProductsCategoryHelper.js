/*
 * Copyright (C) 2009-2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["retail/pmr/promotionaloffers/utils/Utils"],function(U){var P=function(m,a,e){this.masterDataSystem=m;this.includes=a||[];this.excludes=e||[];this.getPayload=function(){this.generatePayload();return this.payload;};this.getHierarchy=function(I,b){this.buildHierarchy(I,b);return this.hierarchy;};this.setMasterData=function(b){this.masterDataSystem=b;};this.formatedNode=function(d,g,n,s,i){var r=i.Id||i.ReferenceId;return{Dimension:d,GroupId:g,Number:n,ReferenceId:r,Sign:s};};this.setIncludes=function(a,r){if(this.includes.length===0||r){this.includes=[];for(var z=0,b=a.length;z<b;z++){if(a[z].Dimension==="03"||typeof a[z].Dimension==="undefined"){var n=this.formatedNode("03",undefined,this.includes.length+1,"I",a[z]);this.includes.push(n);}}}else{for(var i=0,l=a.length;i<l;i++){if(!this.isDuplicateDeep(this.includes,a[i])){var n=this.formatedNode("03",this.includes[0].GroupId,this.includes.length+1,"I",a[i]);this.includes.push(n);}}}};this.setExcludes=function(e,r){if(this.excludes.length===0||r){this.excludes=[];for(var z=0,b=e.length;z<b;z++){if(e[z].Dimension==="03"||typeof e[z].Dimension==="undefined"){var n=this.formatedNode("03",undefined,this.excludes.length+1,"E",e[z]);this.excludes.push(n);}}}else{for(var i=0,l=e.length;i<l;i++){if(!this.isDuplicateDeep(this.excludes,e[i])){var n=this.formatedNode("03",this.excludes[0].GroupId,this.excludes.length+1,"E",e[i]);this.excludes.push(n);}}}};this.setProductsCategory=function(d){this.result=d;};this.getExcludedProducts=function(){var b=[];var h=this.getHierarchy();var f=function(c){if(c.children&&c.children){for(var i=0,l=c.children.length;i<l;i++){if(!c.children[i].isIncluded){b.push(c.children[i]);}else{f(c.children[i]);}}}};if(h&&h.length>0){for(var i=0,l=h.length;i<l;i++){if(!h[i].isIncluded){b.push(h[i]);}else{f(h[i]);}}}return b;};this.slimData=function(b,c){var d=jQuery.extend([],b);var t=[];for(var i=0,l=d.length;i<l;i++){var f={};f.ReferenceId=d[i].Id;f.Dimension=d[i].Dimension;f.Sign=c?"I":"E";t.push(f);}return t;};this.isDuplicateDeep=function(b,c){var f=false;var t=this;var d=function(){for(var j=0,l=b.length;j<l;j++){if(b[j].ReferenceId===c.Id){f=true;break;}}};var g=function(h,j){for(var i=0,l=h.length;i<l;i++){if(h[i].Id===j){f=true;break;}else{if(h[i].children){g(h[i].children,j);}}}};d();if(!f){g(t.hierarchy,c.ParentId);}return f;};};P.prototype.generatePayload=function(){var r=[];for(var i=0,l=this.includes.length;i<l;i++){var a=this.includes[i].ReferenceId||this.includes[i].Id;var b={GroupId:"1",Number:(i+1)+"",Sign:"I",Dimension:"03",ReferenceId:a};r.push(b);}for(var j=0,L=this.excludes.length;j<L;j++){var a=this.excludes[j].ReferenceId||this.excludes[j].Id;var b={GroupId:"1",Number:(i)+(j+1)+"",Sign:"E",Dimension:"03",ReferenceId:a};r.push(b);}this.payload={Id:"1",MasterdataSystem:this.masterDataSystem,Rules:r,Nodes:[],Included:[],Excluded:[]};};P.prototype.buildHierarchy=function(I,a){var t=this;if(!this.result){this.hierarchy=[];return;}var n=this.result.Nodes?this.result.Nodes.results||this.result.Nodes:[];if(I){n=this.result.HierarchyPreview?this.result.HierarchyPreview.results||this.result.HierarchyPreview:[];}var r=this.result.Rules?this.result.Rules.results:[];var f=this.result.Filters?this.result.Filters.results:[];var e=[];var b=function(i,j){var p=jQuery.extend({},i);p.virtualParentId=p.ParentId;delete p.__metadata;p.isIncluded=j;p.Filters=[];return p;};var c=function(){for(var i=0,L=n.length;i<L;i++){if(n[i].Dimension==="03"){e.push(b(n[i],true));}}for(var j=0,p=r.length;j<p;j++){for(var z=0,q=e.length;z<q;z++){if(r[j].Dimension==="03"&&r[j].ReferenceId===e[z].Id){var u=r[j].Sign.indexOf("I")>-1?true:false;e[z].isIncluded=u;}}}};var d=[];var g=function(){for(var i=0,L=r.length;i<L;i++){for(var j=0,p=e.length;j<p;j++){if(r[i].ReferenceId===e[j].Id){e[j].hasParent=false;d.push(e[j]);}}}};var m=function(){for(var i=0,L=d.length;i<L;i++){for(var j=0,p=d.length;j<p;j++){if(d[i].ParentId===d[j].Id){d[i].hasParent=true;}}}};var h=function(){for(var i=0,L=d.length;i<L;i++){if(!d[i].hasParent){d[i].virtualParentId="AAAAAAAAAAAAAAAAAAAAAA==";}}};var k=function(j){var p=function(j){for(var i=0,L=j.length;i<L;i++){j[i].isIncluded=false;if(j[i].children&&j[i].children.length>0){p(j[i].children);}}};var q=function(u,j){for(var i=0,L=j.length;i<L;i++){if(j[i].Id===u&&j[i].children){p(j[i].children);break;}else{if(j[i].children&&j[i].children.length>0){q(u,j[i].children);}}}};for(var i=0,L=j.length;i<L;i++){if(j[i].Sign==="E"){q(j[i].ReferenceId,t.hierarchy);}}};var l=function(){for(var i=t.hierarchy.length-1,L=0;i>=L;i--){if(t.hierarchy[i].isIncluded===false&&U.isInitial(t.hierarchy[i].ParentId)){t.hierarchy.splice(i,1);}}};var o=function(){if(f&&f.length>0){f.forEach(function(i){e.forEach(function(p){if(p.Id===i.NodeId){delete i.__metadata;p.Filters.push(i);}});});}};var s=function(){if(e&&e.length>0){e.forEach(function(p){p.Filters=JSON.stringify(p.Filters);});}};c();g();m();h();o();s();this.hierarchy=U.buildHierarchy(e);if(!I){k(r);}if(a){l();}};P.prototype.markFilterModified=function(h,f){var m=function(a,b){for(var i=0,l=b.length;i<l;i++){var f=JSON.parse(b[i].Filters);if(b[i].Id===a&&f&&f.length>0){b[i].filterModified=true;break;}else if(b[i].children&&b[i].children.length>0){m(a,b[i].children);}}};for(var a in f){m(a,h);}};P.prototype.getSelectedItems=function(e){var t=e.getSource().getTable();var i=[];var p=e.getParameter("tableSelectionParams");if(p.selectAll){p.rowIndices.forEach(function(b){var c=t.getContextByIndex(b);if(c){var o=c.getObject();i.push(o);}}.bind(this));}else{var a=e.getParameter("tableSelectionParams").rowContext.getObject();i.push(a);}return i;};P.prototype.removeIncludeNode=function(i){if(this.includes&&this.includes.length>0){for(var z=this.includes.length-1,a=0;z>=a;z--){if(i===this.includes[z].ReferenceId){this.includes.splice(z,1);break;}}}};return P;},true);
