/*
 * Copyright (C) 2009-2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","retail/pmr/promotionaloffers/utils/Utils"],function(q,C,J,U){"use strict";function a(b){return b.Selected;}function f(b){var c=q.extend(true,{},b);delete c.Selected;return c;}var V=C.extend("retail.pmr.promotionaloffers.plugins.VendorFund",{constructor:function(){C.apply(this,arguments);this.dataProvider=null;this.oModel=new J();this.contentModel=new J();},onInit:function(){this.contentModel.setData({Editable:true});this.getView().setModel(this.oModel);this.oBusyVendorFund=this.getView().byId("busyVendorFunds");this.getView().setModel(U.getResourceModel(),"i18n");this.getView().setModel(this.contentModel,"Content");this.appState=this.getOwnerComponent().getState();},resetView:function(){this.oModel.setData({});},validateForm:function(){return 0;},selectAssociatedVendorFunds:function(b,c){if(!c.length){return;}for(var i=0;i<b.length;i++){for(var j=0;j<c.length;j++){if(c[j].Id===b[i].Id){b[i].Selected=true;}}}},reselectAssociatedVendorFunds:function(b,c){if(!c.length){return;}for(var i=0;i<b.length;i++){for(var j=0;j<c.length;j++){if(c[j].Id===b[i].Id&&c[j].Selected){b[i].Selected=true;}}}},setOfferData:function(d){var b=q.extend(true,[],d.AvailableFunds);var v=q.extend(true,[],d.VendorFunds);if(!d.CreatedOn){this.selectAllVendors(b);}else{this.selectAssociatedVendorFunds(b,v);}this.contentModel.setProperty("/Editable",!d.Readonly);this.oModel.setProperty("/VendorFunds",v);if(d.Readonly){this.oModel.setProperty("/AvailableFunds",v);}else{this.oModel.setProperty("/AvailableFunds",b);}},getOfferData:function(){var b=this.oModel.getProperty("/AvailableFunds")||[];return{VendorFunds:b.filter(a).map(f)};},fetchVendorFunds:function(p){return this.appState.determineVendorFunds(p);},setDataProvider:function(l){this.dataProvider=l;},selectAllVendors:function(b){for(var i=0;i<b.length;i++){b[i].Selected=true;}},cleanPaylodForVendorFunds:function(p){if(p){if(p.Versions){for(var i=0;i<p.Versions.length;i++){var v=p.Versions[i];delete v.LocalNodes;delete v.locationPath;U.cleanFinancialsForVersion(v);}}U.cleanFinancialsForVersion(p);delete p.LocationHierarchy;}return p;},retrieveVendorFunds:function(){this.oBusyVendorFund.open();var c=q.extend(true,{},this.dataProvider.getSavePayload());var p=this.cleanPaylodForVendorFunds(c);return this.fetchVendorFunds(p).then(function(r){var b=r.data;var d=this.oModel.getProperty("/AvailableFunds")||[];if(d.length!==0){this.reselectAssociatedVendorFunds(b,d);}else{this.selectAllVendors(b);}this.oModel.setProperty("/AvailableFunds",b);this.oBusyVendorFund.close();}.bind(this),function(e){this.oBusyVendorFund.close();}.bind(this));}});return V;});
