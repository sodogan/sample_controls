/*
 * Copyright (C) 2009-2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/core/UIComponent","retail/pmr/promotionaloffers/utils/Models","retail/pmr/promotionaloffers/utils/Utils","retail/pmr/promotionaloffers/view/AppState","retail/pmr/promotionaloffers/view/CommunicationProcessor","retail/pmr/promotionaloffers/view/CommunicationProcessorWrapper","retail/pmr/promotionaloffers/view/CommunicationServices","sap/ui/model/json/JSONModel","sap/m/BusyDialog"],function(U,M,a,A,P,W,S,J,B){"use strict";return U.extend("retail.pmr.promotionaloffers.Component",{metadata:{manifest:"json"},_initComponentModels:function(m,d){m[""].settings=m[""].settings||{};m[""].settings["metadataUrlParams"]=m[""].settings["metadataUrlParams"]||{};m[""].settings["metadataUrlParams"]["sap-language"]=sap.ui.getCore().getConfiguration().getLanguageTag();m[""].settings["serviceUrlParams"]=m[""].settings["serviceUrlParams"]||{};m[""].settings["serviceUrlParams"]["sap-language"]=sap.ui.getCore().getConfiguration().getLanguageTag();return U.prototype._initComponentModels.call(this,m,d);},init:function(){U.prototype.init.apply(this,arguments);var m=this.getModel();if(!m){return;}m.setUseBatch(false);m.attachMessageChange(jQuery.proxy(a.messageChangeEvent,a));this._router=this.getRouter();var h=new J({Visible:true,Version:1,ContentAssignmentEnabled:false});var b=new J({ActionAllowed:true});var r=this.getModel("i18n").getResourceBundle();a.setResourceModel(this.getModel("i18n"));var l=new B({text:r.getText("CreateOffer.BusyIndicator.Loading")});var s=new B({text:r.getText("UpdateOffer.BusyIndicatorUpdateOffer.Loading")});this.setModel(h,"UIVisiblity");this.setModel(b,"ActionsAllowed");this.appState=new A();this._router.attachRouteMatched(function(e){var p=e.getParameter("name");var c=e.getParameter("arguments").path;var d=S.get(p,c);var v=e.getParameter("view").getController();var f=v.getOfferDataProvider?v.getOfferDataProvider():{getOfferData:function(){}};var g=new P(this.appState,d,f);var i=new W.showPleaseWait(g,l,s);var u=new W.hideUI(i,h);var j=new W.allowActions(u,b);var k=j;this.appState.setCommunicationProcessor(k);if(p==="manage"){this.appState.invalidate();}},this);this._router.initialize();var o=this.getModel().getMetaModel();o.loaded().then(function(){var v=o.getProperty("/dataServices/schema/0/sap:schema-version");h.setProperty("/Version",v);});this._checkContentIntent(h);},getTermStyles:function(){var c=this.getMetadata().getConfig();return c.termStyles;},getState:function(){return this.appState;},_checkContentIntent:function(m){var s=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");if(s){var c=this.getMetadata().getConfig();s.isNavigationSupported([{target:{semanticObject:c.offerSemanticObject,action:c.contentAction}}]).done(function(r){m.setProperty("/ContentAssignmentEnabled",r[0].supported);});}}});});
