/*
 * Copyright (C) 2009-2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/EventProvider","retail/pmr/promotionaloffers/utils/Utils"],function(E,U){var D=E.extend("retail.pmr.promotionaloffers.utils.DateHandler",{metadata:{events:"dateChanged"},constructor:function(){E.prototype.constructor.apply(this,arguments);this._startDate=null;this._endDate=null;this._startTime=null;this._endTime=null;this._prevStartDate=null;this._prevEndDate=null;this._prevStartTime=null;this._prevEndTime=null;},startDateChanged:function(v,a){if(!(a&&v)){this.fireEvent("dateChanged");return;}this.setPrevStartDate(this.getStartDate());var s=D.getDate(v,this.getStartTime());this.setStartDate(s);if(this.getEndDate().getTime()>this.getPrevStartDate().getTime()){this.adaptEndDate(s);}else{this.setPrevEndDate(this.getEndDate());}this.fireEvent("dateChanged");},endDateChanged:function(v,a){if(!(a&&v)){this.fireEvent("dateChanged");return;}this.setPrevEndDate(this.getEndDate());this.setEndDate(D.getDate(v,this.getEndTime()));this.setPrevStartDate(this.getStartDate());this.fireEvent("dateChanged");},startTimeChanged:function(v){this.setPrevStartTime(this.getStartTime());this.setStartTime(new Date(v));this.setStartDate(D.getDate(this.getStartDate(),this.getStartTime()));this.adaptEndTime();this.fireEvent("dateChanged");},endTimeChanged:function(v){this.setPrevEndTime(this.getEndTime());this.setEndTime(new Date(v));this.setEndDate(D.getDate(this.getEndDate(),this.getEndTime()));this.setPrevStartTime(this.getStartTime());this.fireEvent("dateChanged");},getCombinedStartDate:function(){var d=this.getStartDate();var t=this.getStartTime();return D.getDate(d,t);},getCombinedEndDate:function(){var d=this.getEndDate();var t=this.getEndTime();return D.getDate(d,t);},getCombinedPrevStartDate:function(){var d=this.getPrevStartDate();var t=this.getPrevStartTime();return D.getDate(d,t);},getCombinedPrevEndDate:function(){var d=this.getPrevEndDate();var t=this.getPrevEndTime();return D.getDate(d,t);},updateVersions:function(m){var v=m.getData().Versions;(v||[]).forEach(D.updateRangeIfSame(this),this);sap.ui.getCore().getEventBus().publish("retail.pmr.promotionaloffers","updateVersions",{versions:v});m.refresh(true);},updateTactics:function(d,t){var s=this.getStartDate();var e=this.getEndDate();var p=this.getPrevStartDate();var a=this.getPrevEndDate();var b=this.getPrevStartTime();var c=this.getPrevEndTime();var T=d.getData().Tactics||[];var o=t.getData();var C={StartOfTactic:function(f){var g=D.getDate(f.StartOfTactic,p);if(g.getTime()===p.getTime()){f.StartOfTactic=D.getDate(s,f.StartOfTactic);}},EndOfTactic:function(f){var g=D.getDate(f.EndOfTactic,a);if(g.getTime()===a.getTime()){f.EndOfTactic=D.getDate(e,f.EndOfTactic);}},StartTimeOfTactic:function(f){if(!f.StartTimeOfTactic||D.getTime(f.StartTimeOfTactic).getTime()===D.getTime(b).getTime()){f.StartTimeOfTactic=o.StartTime;f.StartOfTactic=D.getDate(f.StartOfTactic,f.StartTimeOfTactic);f.StartTimeOfTacticValue=this.getFormatTimePiker(f.StartTimeOfTactic);}}.bind(this),EndTimeOfTactic:function(f){if(!f.EndTimeOfTactic||D.getTime(f.EndTimeOfTactic).getTime()===D.getTime(c).getTime()){f.EndTimeOfTactic=o.EndTime;f.EndOfTactic=D.getDate(f.EndOfTactic,f.EndTimeOfTactic);f.EndTimeOfTacticValue=this.getFormatTimePiker(f.EndTimeOfTactic);}}.bind(this)};Object.getOwnPropertyNames(C).forEach(function(f){T.forEach(function(g){C[f](g);});});d.refresh(true);},adaptEndDate:function(s){var e=this.getEndDate();if(!e){return;}this.setPrevEndDate(e);var p=this.getPrevStartDate();var d=e.getTime()-p.getTime();var n=new Date(s.getTime()+d);if(n.getTimezoneOffset()!=e.getTimezoneOffset()){d=n.getTimezoneOffset()-e.getTimezoneOffset();n=new Date(n.getTime()+d*60000);}if(s.getTimezoneOffset()!=p.getTimezoneOffset()){d=s.getTimezoneOffset()-p.getTimezoneOffset();n=new Date(n.getTime()-d*60000);}this.setEndDate(n);},adaptEndTime:function(){var p=this.getPrevStartTime();var e=this.getEndTime();var s=this.getStartTime();var a=this.getEndDate();var d=e.getTime()-p.getTime();var n=new Date(s.getTime()+d);var o=new Date(a.getTime()+(n.getTime()-e.getTime()));this.setPrevEndTime(e);this.setPrevEndDate(a);this.setEndTime(n);this.setEndDate(o);},onAllDaySelect:function(){var s=new Date(this.getStartTime());var e=new Date(this.getEndTime());this.setPrevStartTime(this.getStartTime());this.setPrevEndTime(this.getEndTime());this.setPrevEndDate(this.getEndDate());this.setPrevStartDate(this.getStartDate());this.setStartTime(new Date(s.setHours(0,0,0,0)));this.setStartDate(D.getDate(this.getStartDate(),this.getStartTime()));this.setEndTime(new Date(e.setHours(23,59,59,0)));this.setEndDate(D.getDate(this.getEndDate(),this.getEndTime()));this.fireEvent("dateChanged");},getFormatTimePiker:(function(){var t=new sap.m.TimePicker();return function(a){if(!a){return"";}return t._formatValue(a);};}()),setStartDate:function(v){this._startDate=v;},setEndDate:function(v){this._endDate=v;},setStartTime:function(v){this._startTime=v;},setEndTime:function(v){this._endTime=v;},setPrevStartDate:function(v){this._prevStartDate=v;},setPrevEndDate:function(v){this._prevEndDate=v;},setPrevStartTime:function(v){this._prevStartTime=v;},setPrevEndTime:function(v){this._prevEndTime=v;},getStartDate:function(){return this._startDate;},getEndDate:function(){return this._endDate;},getStartTime:function(v){return this._startTime;},getEndTime:function(v){return this._endTime;},getPrevStartDate:function(v){return this._prevStartDate;},getPrevEndDate:function(v){return this._prevEndDate;},getPrevStartTime:function(v){return this._prevStartTime;},getPrevEndTime:function(v){return this._prevEndTime;}});D.updateRangeIfSame=function updateRangeIfSame(d){var s=d.getCombinedStartDate();var e=d.getCombinedEndDate();var p=d.getCombinedPrevStartDate()||s;var a=d.getCombinedPrevEndDate()||e;return function(v){var b=v.StartOfOffer.getTime();var c=p.getTime();var f=v.EndOfOffer.getTime();var g=a.getTime();if(b===c){v.StartOfOffer=new Date(s.getTime());}if(f===g){v.EndOfOffer=new Date(e.getTime());}return v;};};D.getDate=function(d,t){if(!d||!t){return d;}var o=new Date(d.getTime());o.setHours(t.getHours(),t.getMinutes(),t.getSeconds(),0);return o;};D.getTime=function(d){var r=new Date(0);r.setHours(d.getHours());r.setMinutes(d.getMinutes());r.setSeconds(d.getSeconds());return r;};return D;});
