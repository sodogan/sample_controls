/*
 * Copyright (C) 2009-2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["retail/pmr/promotionaloffers/utils/Models","retail/pmr/promotionaloffers/plugins/terms/styles/AbstractTermObjectController","retail/pmr/promotionaloffers/utils/Utils","retail/pmr/promotionaloffers/utils/TreeValueHelpDialog","retail/pmr/promotionaloffers/utils/ValueHelpDialog"],function(M,A,U,T,V){function d(v,t,a,b){var c=M.getTermObjects(a,b).then(function(r){return r.TermObjects;}).then(function(g){return U.buildTree(g);});return T.openDialog({tableFragment:v,title:"{i18n>productHierarchy.Title}",filterProps:["Title","SubTitle","Info1","Info2"],values:c}).then(function(s){return s.Id;});}function m(p,o,a){return p.map(function(b){for(var i=0;i<o.length;i++){if(b.ProductId===o[i].ProductId&&a===o[i].ParentId){o[i].isNewItem=false;return o[i];}}b.isNewItem=true;return b;});}function P(){A.apply(this,arguments);}P.prototype=Object.create(A.prototype);P.prototype.getDimension=function(){return"03";};P.prototype.handleProductDetails=function(p,a,t,s){var o=this.productDetails.getProductDetails()||[];var b=jQuery.extend(true,{},t);this.productDetails.remove(b);if(a){var c=(U.get(a,["Children","results"])||[]).filter(function(i){return i.Dimension==="01";});if(s){this.productDetails.add(m(c,o,t.TermType+"-"+t.Identifier),t);}else{this.productDetails.add(c,t);}}};P.prototype.populateModel=function(a,p,b){a.setProperty(p+"/Selection/ProductId",null);a.setProperty(p+"/Selection/HierarchyId",b.HierarchyId);a.setProperty(p+"/Selection/HierarchyNodeId",b.HierarchyNodeId);a.setProperty(p+"/Selection/ExtProductId",null);a.setProperty(p+"/Selection/ExtHierarchyId",null);a.setProperty(p+"/Selection/ExtHierarchyNodeId",b.ExtNodeId);a.setProperty(p+"/Selection/Description",b.Name);a.setProperty(p+"/ProductTextValue",b.ExtNodeId);a.setProperty(p+"/ProductDescriptionValue",b.Name);a.setProperty(p+"/DiscountDescription",b.ProductDetail.Currency);a.setProperty(p+"/Selection/Products",b.HierarchyId?b.Cardinality:0);};P.prototype.openValueHelpDialog=function(e,a){return d("retail.pmr.promotionaloffers.plugins.terms.controls.search.MerchandiseCategorySearch","XML",a,"03").then(function(i){return M.getProductById(i,"03");});};return P;},true);
