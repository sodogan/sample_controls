/*
 * Copyright (C) 2009-2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/model/json/JSONModel","retail/pmr/promotionaloffers/utils/Utils"],function(J,U){function g(i){return i.NodeId||i.LocationId||i.ExtLocationNodeId;}function V(d){this.availableVersions=jQuery.extend(true,[],d.Versions).map(function(i){i.LocationId=i.LocationNodeId;delete i.LocationNodeId;return i;});this.availableHierarchy=jQuery.extend(true,[],d.LocationHierarchy);this.availableLocalNodes=jQuery.extend(true,[],d.LocalNodes);this.manipulateHierarchy();var r=U.filterData(this.availableHierarchy);this.hierarchy=U.buildHierarchyVH(r);this.markUserCreatedNodes();this.calculateBreadcrumb();}V.prototype.markUserCreatedNodes=function(a){var u=[];var r=function(a){if(a&&a.userCreatedNode){b(g(a));}for(var i in a){if(a.hasOwnProperty(i)&&jQuery.isNumeric(i)){r(a[i]);}}};var b=function(e){if(u.length===0){u.push(e);}else{var f=false;for(var i=0,l=u.length;i<l;i++){if(u[i]===e){f=true;}}if(f){u.push(e);}}};var c=function(e,a){if(g(a)===e){d(a);}for(var i in a){if(a.hasOwnProperty(i)&&jQuery.isNumeric(i)){c(e,a[i]);}}};var d=function(a){a.userCreatedNode=true;for(var i in a){if(a.hasOwnProperty(i)&&jQuery.isNumeric(i)){d(a[i]);}}};r(this.hierarchy[0]);for(var i=0,l=u.length;i<l;i++){c(u[i],this.hierarchy[0]);}};V.prototype.manipulateHierarchy=function(){if(this.availableLocalNodes&&this.availableLocalNodes.length>0){var l=this.availableLocalNodes;for(var i=0,L=l.length;i<L;i++){var a=l[i].Id||l[i].Description;var v=this.getUserCreateNodeNameFromVersion(a);var c=l[i].Children||[];var n=[];var b=[];var d=[];for(var j=0,e=c.length;j<e;j++){var r=this.moveToNewParent(c[j]);if(r){n.push(r);var t=r.ExtNodeId||r.ExtLocationId;if(r.Name){t=r.Name+" ("+t+")";}b.push(t);d.push(r.LocationId||r.NodeId);}}var f=b.join(";");var h=d.join(";");var k=n.length>0?n:[];this.availableHierarchy.push({Locations:k,NodeId:l[i].Id,ParentId:l[i].ParentId,ExtNodeId:l[i].Description,userCreatedNode:true,NodeName:f,VersionName:v,LocationIds:h});}}};V.prototype.getUserCreateNodeNameFromVersion=function(a){var v=this.availableVersions;if(!v){return null;}for(var i=0;i<v.length;i++){var l=v[i].LocationId||v[i].LocationNodeId||v[i].ExtLocationNodeId;if(a===l){return v[i].Name||null;}}return null;};V.prototype.moveToNewParent=function(a){var t=null;var b="";var c=g(a);var d=this.availableHierarchy;for(var i=0,l=d.length;i<l;i++){b=g(d[i]);if(b===c){t=jQuery.extend(true,{},d[i]);d.splice(i,1);break;}else{var e=d[i].Locations;for(var j=0;j<e.length;j++){var b=g(e[j]);if(b===c){t=jQuery.extend(true,{},e[j]);e.splice(j,1);break;}}}}return t;};V.prototype.calculateBreadcrumb=function(){var t=this;var f=[];U.flattenTree(f,this.hierarchy);var a=function(h){for(var i=0,L=f.length;i<L;i++){if(f[i].NodeId===h||f[i].LocationId===h){return f[i];}}};var b=function(h,j){for(var i=0,L=h.length;i<L;i++){if(g(h[i])===j.ParentId){j.Path=h[i].ExtNodeId+" > "+j.Path;if(U.isInitial(h[i].ParentId)){j.ParentId=h[i].ParentId;break;}else{j.ParentId=h[i].ParentId;b(h,j);}}}};var m=function(){var v=t.availableVersions;var h=t.availableLocalNodes;for(var i=0,L=v.length;i<L;i++){for(var j=0,k=h.length;j<k;j++){var n=h[j].Id||h[j].Description;if(g(v[i])===n){v[i].LocalNodes=h[j];}}}};var l=function(h){h.Crumbs=[];if(h.Children===null){return;}for(var i=0,L=f.length;i<L;i++){for(var j=0,k=h.Children.length;j<k;j++){if(g(h.Children[j])===g(f[i])){var n=f[i].Name||f[i].ExtNodeId||f[i].ExtLocationId;var p=n;h.Crumbs.push({Path:p,ParentId:h.ParentId});}}}};var s=function(i,v){var h=i.ExtNodeId?i.ExtNodeId:i.Name;if(v.locationPath){v.locationPath=h+" > "+v.locationPath;}else{v.locationPath=h;}};var c=function(h,j,v){for(var i=0,L=h.length;i<L;i++){if(U.isInitial(j)){break;}else if(g(h[i])===j){s(h[i],v);c(h,h[i].ParentId,v);}}};var d=function(v){var h=false;for(var i=0;i<t.availableLocalNodes.length;i++){if(v.LocationId===t.availableLocalNodes[i].Id){h=true;break;}}if(v.LocalNodes){h=true;}return h;};var e=function(){var v=t.availableVersions;for(var z=0,h=v.length;z<h;z++){if(v[z].LocalNodes){l(v[z].LocalNodes);var i=v[z].LocalNodes.Crumbs;for(var j=0,L=i.length;j<L;j++){b(f,i[j]);}var p="";for(var q=0,k=i.length;q<k;q++){if(p&&i[q].Path){var n=i[q].Path.split(">");p+=n[n.length-1].trim()+";";}else if(p===""){p+=i[q].Path+";";}}v[z].locationPath=p;}else{c(f,g(v[z]),v[z]);}}};m();e();};V.prototype.getAvailableVersions=function(){return this.availableVersions;};V.prototype.getHierarchy=function(){return this.hierarchy;};V.prototype.getAvailableHierarchy=function(){return this.availableHierarchy;};return V;},true);
