/*
 * Copyright (C) 2009-2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/m/ComboBox","sap/m/ComboBoxRenderer","sap/ui/core/Item",],function(C,a,I){"use strict";var S="SecondLevel";var P="isParent";if(sap.ui.version>="1.62.0"){var L=sap.m.List.extend("retail.pmr.promotionaloffers.utils.controls.ListHierarchy",{renderer:sap.m.ListRenderer.render,onAfterRendering:function(){var e=this.getItems()||[];var o=this._oComboBox;for(var i=0,l=e.length;i<l;i++){if(o._getItemByListItem(e[i]).data(S)){e[i].$().css("text-indent","1.5rem");}else if(o._getItemByListItem(e[i]).data(P)){e[i].$().removeClass("sapMSelectListItemBase sapMSelectListItemBaseInvisible sapMSelectListItemBaseDisabled sapMSelectListItemBaseHoverable");e[i].$().addClass("sapMSelectListItem");}}}});var H=C.extend("retail.pmr.promotionaloffers.utils.controls.HierarchicalComboBox",{renderer:a.render,init:function(){C.prototype.init.apply(this,arguments);this._aParentItems=[];this._config={binding:"TermStyles",parentKey:"Group",parentText:"GroupDescription"};this.aTermStyleItems=[];},metadata:{aggregations:{termStyles:{type:"sap.ui.core.Item",multiple:true,singularName:"termStyle",bindable:"bindable"}}}});H.prototype.setConfig=function(e){if(!e.binding||!e.parentKey||!e.parentText){return;}this._config=e;};H.prototype.addTermStyle=function(i){this.addItem(i);this.aTermStyleItems.push(i);var o=i.getBindingContext(this._config.binding);if(!o){return this;}var e=function(D){var f=new sap.ui.core.Item({key:D[this._config.parentKey],text:D[this._config.parentText]});f.data(P,true);f.setEnabled(false);this._aParentItems.push(f);this.aTermStyleItems.push(f);this.addItem(f);}.bind(this);var D={};var p=o.getPath();D=o.getModel().getProperty(p)||[];if(D[this._config.parentText]){i.data(S,D[this._config.parentKey]);if(!this.findItem("key",D[this._config.parentKey])){e(D);}}this.orderItems();return this;};H.prototype.createList=function(){this._oList=new L({width:"100%",mode:sap.m.ListMode.SingleSelectMaster,rememberSelections:false,busyIndicatorDelay:0,showSeparators:sap.m.ListSeparators.None}).addStyleClass(this.getRenderer().CSS_CLASS_COMBOBOXBASE+"List").addStyleClass(this.getRenderer().CSS_CLASS_COMBOBOX+"List").attachSelectionChange(this.onSelectionChange,this).attachItemPress(this.onItemPress,this);this._oList._oComboBox=this;return this._oList;};H.prototype.getChildrensByParent=function(p,e){var f=[];for(var i=0,l=e.length;i<l;i++){if(!e[i].data(P)&&e[i].data(S)===p){f.push(e[i]);}}return f;};H.prototype.orderItems=function(){var e=this.aTermStyleItems;var f=[];var g=[];var i,l;var h=[];for(i=0,l=e.length;i<l;i++){if(e[i].data(P)){f.push(e[i]);f=f.concat(this.getChildrensByParent(e[i].getKey(),e));}if(!e[i].data(P)&&!e[i].data(S)){g.push(e[i]);}}f=f.concat(g);for(i=0,l=f.length;i<l;i++){h.push({item:f[i],index:i});}this.removeAllItems();h.forEach(function(o){this.insertItem(o.item,o.index);}.bind(this));};H.prototype.getItems=function(){var l=this.getList();var e=[];if(l){var o=this.getAggregation("items",[]);for(var i=0,f=o.length;i<f;i++){if(!o[i].data(P)){e.push(o[i]);}}}return e;};H.prototype.oninput=function(e){var f=this._aParentItems;for(var i=0,l=f.length;i<l;i++){if(f[i].data(P)){this._setItemVisibility(f[i],false);}}C.prototype.oninput.apply(this,arguments);};}else{jQuery.sap.require("sap/m/SelectList");jQuery.sap.require("sap/m/SelectListRenderer");var b=sap.m.SelectList;var c=sap.m.SelectListRenderer;var d=b.extend("retail.pmr.promotionaloffers.utils.controls.SelectListHierarchy",{renderer:c.render,onAfterRendering:function(){var e=this.getItems()||[];for(var i=0,l=e.length;i<l;i++){if(e[i].data(S)){e[i].$().css("text-indent","1.5rem");}else if(e[i].data(P)){e[i].$().removeClass("sapMSelectListItemBase sapMSelectListItemBaseInvisible sapMSelectListItemBaseDisabled sapMSelectListItemBaseHoverable");e[i].$().addClass("sapMSelectListItem");}}}});var H=C.extend("retail.pmr.promotionaloffers.utils.controls.HierarchicalComboBox",{renderer:a.render,init:function(){C.prototype.init.apply(this,arguments);this._aParentItems=[];this._config={binding:"TermStyles",parentKey:"Group",parentText:"GroupDescription"};},metadata:{aggregations:{termStyles:{type:"sap.ui.core.Item",multiple:true,singularName:"termStyle",bindable:"bindable"}}}});H.prototype.setConfig=function(e){if(!e.binding||!e.parentKey||!e.parentText){return;}this._config=e;};H.prototype.updateTermStyles=function(r){this.destroyItems();this.destroyTermStyles();this.updateAggregation("termStyles");};H.prototype.addTermStyle=function(i){this.addItem(i);var o=i.getBindingContext(this._config.binding);if(!o){return this;}var e=function(D){var f=new sap.ui.core.Item({key:D[this._config.parentKey],text:D[this._config.parentText]});f.data(P,true);f.setEnabled(false);this._aParentItems.push(f);this.addItem(f);}.bind(this);var D={};var p=o.getPath();D=o.getModel().getProperty(p)||[];if(D[this._config.parentText]){i.data(S,D[this._config.parentKey]);if(!this.findItem("key",D[this._config.parentKey])){e(D);}}this.orderItems();return this;};H.prototype.createList=function(){this._oList=new d({width:"100%"}).addStyleClass(this.getRenderer().CSS_CLASS+"List").attachSelectionChange(this.onSelectionChange,this).attachItemPress(this.onItemPress,this);return this._oList;};H.prototype.getChildrensByParent=function(p,e){var f=[];for(var i=0,l=e.length;i<l;i++){if(!e[i].data(P)&&e[i].data(S)===p){f.push(e[i]);}}return f;};H.prototype.orderItems=function(){var e=this.getList().getItems();this.removeAllItems();var f=[];var g=[];var i,l;for(i=0,l=e.length;i<l;i++){if(e[i].data(P)){f.push(e[i]);f=f.concat(this.getChildrensByParent(e[i].getKey(),e));}if(!e[i].data(P)&&!e[i].data(S)){g.push(e[i]);}}f=f.concat(g);for(i=0,l=f.length;i<l;i++){this.insertItem(f[i],i);}};H.prototype.getItems=function(){var l=this.getList();var e=[];if(l){var o=l.getItems();for(var i=0,f=o.length;i<f;i++){if(!o[i].data(P)){e.push(o[i]);}}}return e;};H.prototype.oninput=function(e){var f=this._aParentItems;for(var i=0,l=f.length;i<l;i++){if(f[i].data(P)){this._setItemVisibility(f[i],false);}}C.prototype.oninput.apply(this,arguments);};}return H;});
