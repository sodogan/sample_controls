/*
 * Copyright (C) 2009-2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["retail/pmr/promotionaloffers/utils/Utils","sap/ui/model/json/JSONModel","sap/viz/ui5/format/ChartFormatter","sap/viz/ui5/api/env/Format"],function(U,J,F,a){"use strict";var _=1;var b=2;var c=3;var d=null;function e(m,t){if(d){return;}d=sap.ui.xmlfragment("retail.pmr.promotionaloffers.fragments.Forecast",{onOK:function(){d.close();d.destroy();d=null;}});d.setModel(m);d.setModel(t,"i18n");a.numericFormatter(F.getInstance());var h=F.DefaultPattern;var C={interaction:{selectability:{mode:"NONE"}},title:{visible:false},categoryAxis:{title:{visible:false}},valueAxis:{title:{visible:true,text:"Net Units"}},plotArea:{dataLabel:{formatString:h.STANDARDINTEGER,visible:true}}};var o={interaction:{selectability:{mode:"NONE"}},title:{visible:false},categoryAxis:{title:{visible:false}},valueAxis:{title:{visible:false}},plotArea:{dataLabel:{formatString:h.STANDARDINTEGER,visible:true}}};var i=new J();i.setData({ConfigFall:C,ConfigCol:o,Decomposition:[],Confidence:[]});d.setModel(i,"data");}function f(r){var m=d.getModel();var i=d.getModel("i18n");var o=d.getModel("data");var t=0;var s=0;var h=[];var B=["Base","Seasonality","Holidays"];B.forEach(function(k){s+=Math.round(parseFloat(r[k],10));t+=Math.round(parseFloat(r[k],10));switch(k){case"Base":h.push({Type:"null",Category:i.getProperty("ForecastDialog.Base"),Forecast:Math.round(r[k])});break;case"Seasonality":h.push({Type:"null",Category:i.getProperty("ForecastDialog.Seasonality"),Forecast:Math.round(r[k])});break;case"Holidays":h.push({Type:"null",Category:i.getProperty("ForecastDialog.Holidays"),Forecast:Math.round(r[k])});break;}});h.push({Type:"subtotal:3",Category:i.getProperty("ForecastDialog.Baseline"),Forecast:s});s=0;if(r.hasOwnProperty('UserDIF')){var O=["UserDIF"];O.forEach(function(k){s+=Math.round(parseFloat(r[k],10));t+=Math.round(parseFloat(r[k],10));h.push({Type:"null",Category:i.getProperty("ForecastDialog.UserDIF"),Forecast:Math.round(r[k])});});h.push({Type:"subtotal:4",Category:i.getProperty("ForecastDialog.Other"),Forecast:s});s=0;}var p=["PriceChanges","LiftImpactType","TacticImpact","RewardIncentives"];p.forEach(function(k){s+=Math.round(parseFloat(r[k],10));t+=Math.round(parseFloat(r[k],10));switch(k){case"PriceChanges":h.push({Type:"null",Category:i.getProperty("ForecastDialog.Price"),Forecast:Math.round(r[k])});break;case"LiftImpactType":h.push({Type:"null",Category:i.getProperty("ForecastDialog.LiftImpactType"),Forecast:Math.round(r[k])});break;case"TacticImpact":h.push({Type:"null",Category:i.getProperty("ForecastDialog.TacticImpact"),Forecast:Math.round(r[k])});break;case"RewardIncentives":h.push({Type:"null",Category:i.getProperty("ForecastDialog.RewardIncentives"),Forecast:Math.round(r[k])});break;}});s+=Math.round(parseFloat(r.Cannibalization,10));t+=Math.round(parseFloat(r.Cannibalization,10));h.push({Type:"subtotal:5",Category:i.getProperty("ForecastDialog.PromotionalLift"),Forecast:s});h.push({Type:"total",Category:"Total",Forecast:t});var C=["ProdLocsWithLowFCI","ProdLocsWithMediumFCI","ProdLocsWithHighFCI","ProdLocsWithoutForecast"];var j=[];C.forEach(function(k){j.push({Category:m.getProperty("/#Forecast/"+k+"/@sap:label"),Locations:r[k]});});o.setProperty("/Decomposition",h);o.setProperty("/Confidence",j);}function g(l,C){var p="";switch(l){case _:p="/Offers(binary'"+U.base64ToHex(C.OfferId)+"')/Forecast";break;case b:p="/OfferTerms(OfferId=binary'0',TermId=binary'"+U.base64ToHex(C.TermId)+"')/Forecast";break;case c:p="/TermProducts(binary'"+U.base64ToHex(C.TermProductId)+"')/Forecast";break;}var m=d.getModel();m.read(p,{success:f});}var D={show:function(l,C,m,t){e(m,t);g(l,C);d.open();},close:function(){d.close();},Level:{Offer:_,Term:b,Product:c}};return D;},true);
