/*
 * Copyright (C) 2009-2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define([],function(){function A(){this.processor=null;this.transientData=null;this.offerData=null;this.staticData=null;this.transientSnapshot=null;this.valid=false;}A.prototype.createSnapshot=function(){var s={};if(this.transientSnapshot){s=this.transientSnapshot;}else{s=this.processor.createSavePayload();}this.processor.storeSnapshot(s);};A.prototype.setCommunicationProcessor=function(p){this.processor=p;};A.prototype.invalidate=function(){this.transientSnapshot=null;this.valid=false;};A.prototype.validate=function(){this.valid=true;};A.prototype.storeValid=function(){this.oldValid=this.valid;};A.prototype.storeBack=function(v){this.historyBack=v;};A.prototype.restoreValid=function(){if(this.oldValid){this.valid=this.oldValid;this.oldValid=null;}};A.prototype.load=function(d){var p=this.processor;var t=this;if(this.valid||this.historyBack){this.historyBack=false;return new Promise(function(r){setTimeout(function(){d();r();},100);});}return p.onInit(function(){t.offerData=p.getOfferData();t.staticData=p.getStaticData();t.valid=true;this.historyBack=false;t.transientData=null;d();});};A.prototype.storeTransientSnapshot=function(t){this.transientSnapshot=t||this.processor.getSnapshot();delete this.transientSnapshot.Readonly;};A.prototype.setTransientSnapshot=function(t){this.transientSnapshot=t||this.processor.getSnapshot();};A.prototype.store=function(){this.transientData=Array.prototype.splice.call(arguments,0);};A.prototype.storeLocationSubgroups=function(s){this.locationSubgroups=s;};A.prototype.getLocationSubgroups=function(){return this.locationSubgroups||[];};A.prototype.getSavePayload=function(){var p=this.processor.createSavePayload();delete p.Readonly;return p;};A.prototype.getSavePayloadWithFinancials=function(){return this.processor.createSavePayloadWithFinancials();};A.prototype.getOfferData=function(){var a=[true,{},this.offerData].concat(this.transientData);var o=jQuery.extend.apply(jQuery,a);if(this.transientData){var u=this.transientData[0];if(u.LocationHierarchy){o.LocationHierarchy=u.LocationHierarchy;}if(u.LocationSubgroups){o.LocationSubgroups=u.LocationSubgroups;}o.LocalNodes=u.LocalNodes;o.ExcludedNodes=u.ExcludedNodes;o.LocationFilters=u.LocationFilters;o.Versions=u.Versions;o.Terms=u.Terms;}if(!o.PackageOffer){delete o.PackageValue;}return o;};A.prototype.getStaticData=function(){return this.staticData;};A.prototype.hasChanges=function(){return this.processor.hasChanges();};A.prototype.calculateFinancials=function(p){return this.processor.calculateFinancials(p);};A.prototype.determineVendorFunds=function(p){return this.processor.determineVendorFunds(p);};A.prototype.calculateForecast=function(p){return this.processor.calculateForecast(p);};A.prototype.detectCollisions=function(p){return this.processor.detectCollisions(p);};A.prototype.save=function(){var t=this;this.transientData=null;return t.processor.saveOffer(this.getOfferData()).then(function(r){t.valid=true;return t.processor.processData(r).then(function(o){t.offerData=o;return r;});});};return A;},true);
